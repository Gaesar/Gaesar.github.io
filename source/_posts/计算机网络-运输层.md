---
title: 计算机网络-运输层
date: 2024-05-22 09:54:13
tags: 计算机网络
---



### 传输层功能：

1主机上应用进程之间提供逻辑通信

2 具有复用和分用的功能：复用：多个进程可以使用同一个传输协议。分用：去除首部后可以正确分发给进程

3 具有差错检测的功能：TCP出错重发，UDP出错丢弃

4 提供面向连接和无连接的传输协议

### 端口：

作用：标识主机中的应用进程，连接应用层的进程和传输层

硬件端口：不同硬件设备之间进行交互的接口

软件端口：应用层进程和传输实体之间交互的地址

端口号：16bit 分为服务器端使用的端口和客户端使用的端口。服务器端使用的端口分为熟知端口(0-1023)和登记端口(1024-49151)。客户端使用的端口号也叫短暂端口号(49152-65535)，客户进程运行时动态选择。

套接字：唯一标识网络中一台主机上的一个进程，将端口号拼接到IP地址上

### 无连接服务和面向连接服务

TCP: 面向连接的传输控制协议，向上提供全双工的的可靠逻辑通信。

UDP: 无连接的用户数据报协议，向上提供不可靠的逻辑通信。

TCP：通信前必须建立连接，结束后释放，不提供多播和广播的功能

UDP：通信前不需要建立连接，提不需要返回确认，供了多路复用和错误检查

TCP：为了实现可靠通信采用了：确认、流量控制、计时器、连接管理等措施，增加了首部长度浪费处理机资源，开销大，使用与可靠性十分重要的场景

UDP：执行速度快、实时性好

TCP：FTP、SMTP、TELNET、HTTP

UDP：DNS、TFTP、RIP

### 习题

1.通信子网是：网络层、数据链路层、物理层，提供数据通信服务

  资源子网是：应用层、表示层、会话层

  传输层的任务是向资源子网屏蔽通信子网的细节 （路由协议、网络拓扑）

2.可靠传输协议中的可靠和不可靠关键是有没有确认

3.TCP和UDP具有独立的端口号空间，互不干扰，也就是说可以共用某一个端口

4.TCP和IP的首部长度都是20B

5.使用UDP时的可靠性要在应用层保证

### UDP

1.UDP在IP之上增加了复用和分用、差错检测、端口功能，应用程序几乎和IP打交道。

2.优点：

1.无需建立连接，没有建立连接的时延。

2.没有连接的状态参数，首部开销小，8B，可以支持更多的连接

3.没有拥塞控制，可以以稳定的速率发送数据，容忍一些数据的丢失

4.支持一对一一对多多对一多对多交互式通信

3.什么时候用UDP?一次传输的数据少，可靠性要求不高，但实时性要求高的场景：视频通话、流媒体、DNS、SNMP

4.可靠性工作有应用层完成

5.报文是UDP数据传输处理的最小单位，一次只发送和交付一个报文，不可拆分，不可分割。长度选择很重要，太长会导致IP层分片，太短影响传输效率。

6.首部格式：

UDP分为首部和用户数据

首部8B，4字段，每个字段2B 16bit，源端口（可选，0不用）、目的端口、UDP数据报长度、检验和（可选，0不用，恰好为0设为1）

接收方发现UDP中的目的端口号不正确会通过ICMP发送’端口不可到达‘的差错报文给发送方。

![image-20240522111521080](https://cdn.jsdelivr.net/gh/Gaesar/Gaesar.github.io@main/pic/202405221115156.png)

7.UDP校验：

校验和是通过伪首部计算得到的，伪首部只是为了计算校验和，不向下传递，不向上交付

IP数据报的检验值只检验IP首部，UDP检验检验首部和数据

计算过程：

1.检验和字段暂时设为全0，并添加伪首部

2.将数据报按2B划分字，不够补全0

3.按二进制反码计算出所有字的和，取反后填入检验和字段

4.去除伪首部，发送

5.收到后添加伪首部，按2B划分字，不够补全0（不发送）

6.按二进制反码计算出所有字的和

7.如果结果全1，则正确，否则出现错误

既可以检查端口号也可以检查IP地址

虽然校错不强，但简单、速度快

![image-20240522113135680](https://cdn.jsdelivr.net/gh/Gaesar/Gaesar.github.io@main/pic/202405221131728.png)

![image-20240522113200550](https://cdn.jsdelivr.net/gh/Gaesar/Gaesar.github.io@main/pic/202405221132598.png)

### 习题

1.远程登录为了保证数据传输的安全性，不能使用UDP，远程调用、C/S、多媒体可以使用UDP

2.UDP首部8B

3.IP数据报的最大长度是1500B，其中首部（20-60）字节，数据部分最大1480B（不强调首部默认20B）

4.以太网MAC帧首尾共18B

5.UDP的差错检验只是检测是否出错，出错直接丢弃，不保证可靠性，可靠性由应用层保证

6.为什么要有UDP？UDP包含目的端口号，可以将分组交付给正确的进程，还可以对数据进行差错检测，IP只可以投递给主机对首部检测

7.实时数据为什么不用TCP?TCP通过建立连接、确认、重传、拥塞控制保证可靠性，但增加了网络延迟、开销、数据传输速率不稳定，还有乱序、重复等。影响实时性。可以忍受少量数据丢失，但不能忍受延迟。文件传输为什么不用UDP。UDP无法保证可靠性，可能会丢失数据。

8.片偏移单位是8B，算出每个的长度，计算出第一个的字节位置，然后除以8
