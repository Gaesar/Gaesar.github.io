```
title: 测试
date: 2024-05-21 11:30:32
tags: 测试
```

# 6、应用层

## 6.1 网络应用模型

### 6.1.1 C/S模型

1.客户/服务器模型，涉及到两个主体：服务器和客户机。总是打开的主机是服务器，向服务器发起请求的主机是客户机。

2.工作流程是：1.服务器等待接收客户机请求 2.客户机向服务器发起请求，等待接收服务器结果 3.服务器受到请求后，分析处理后将结果返回给客户机

3.实质上是客户机程序向服务器程序发起请求，服务器程序可以同时处理多个请求。

4.C/S的特点：1.客户机是服务请求方、服务器是服务提供方，客户程序必须知道服务器程序的地址，服务器程序不需要知道客户程序的地址，第一次请求结束后服务器程序就知道客户机程序的地址了 2.主机低位不平等，服务器可以通过用户权限管理客户机，网络的管理集中 3.客户机之间不能直接通信，通过服务器通信 4.扩展性不好，服务器会受到硬件和带宽的限制，支持的客户机数有限，系统的性能和服务器的性能有关

5.常见的有：Web、FTP、远程登录、电子邮件、DNS

### 6.1.2 P2P模型

1.P2P模型，Peer to Peer，任意一对计算机直接通信，每个结点既是客户机又是服务器。

2.P2P的特点：1.将任务分配到了各个结点上，消除了对某个服务器的依赖，解除服务器性能的瓶颈，提高了系统效率和资源利用率 2.多个主机之间可以直接共享文档 3.单个结点失效不影响其他结点，健壮性强 3.获取服务的同时向其他主机提供服务，占用内存，影响整机速度

3.各大ISP反对P2P，因为P2P程序占用互联网50%~90%的流量，使网络非常拥塞

## 6.2 DNS域名系统

1.DNS，是因特网使用的命名系统，域名系统，域名就是标记计算机的具有特殊含义的字符串，机器无法处理，域名系统就用于将域名转为机器可以处理的IP地址。

2.DNS采用C/S模型，运行在UDP上，使用53号端口，概念上分为三部分：层次域名空间、域名服务器、解析器

### 6.2.1 层次域名空间

1.任何一个连接到互联网上的主机或路由器都有唯一一个域名。

2.英文不区分大小写，除了-不能有其他特殊符号，一个子域名不超63字符，域名不超255字符，级别最低的在左边，最高的在右边

3.TLD顶级域名：nTLD国家.cn .us .uk gTLD通用：.com公司 .net网络服务机构 .org非营利性组织 .edu教育机构 .gov国家政府 基础结构域名 用于反向域名解析

4.各级域名由上一级域名管理机构管理，顶级域名由“因特网名称与数字地址分配机构”管理。国家下的二级域名由国家制定。

### 6.2.2 域名服务器

1.域名系统用于将域名转为IP地址，这个过程由运行在域名服务器上的程序完成。DNS使用了大量域名服务器，以层次的方式组织

2.一个权限域名服务器管理一个区，区中的所有结点是连通的，权限域名服务器中保存了这个区中所有主机的域名和IP地址的映射，还保存有其他的域名服务器的信息，自己不能转换的时候去找其他域名服务器。

3.没有一台域名服务器具有因特网所有域名的映射，这些映射分布在所有的域名服务器上

4.4种域名服务器：1.根域名服务器：知道顶级域名服务器的域名和IP地址，为了安全性和可靠性，有13个冗余的根域名服务器，不直接转换地址，只提供顶级域名服务器的地址。2.顶级域名服务器：管理所有二级域名，提供下一个查询域名服务器的地址或直接返回结果 3.权限域名服务器：每台主机都在权限域名服务器登记，将主机名转为IP地址 4.本地域名服务器：

### 6.2.3 解析器

1.域名解析过程：本地DNS客户端构造一个DNS请求报文，UDP的方式发送给本地域名服务器。

2.域名解析方式：1.递归查询：本地域名服务器查询不到域名对应的IP地址，本地域名服务器以客户的身份向根域名服务器发送UDP请求报文，根域名服务器根据顶级域名找到顶级域名服务器的地址，向顶级域名服务器发送UDP请求报文，顶级域名服务器根据二级域名找到权限域名服务器的地址，向权限域名服务器发送UDP请求报文 ，权限域名服务器查询出IP地址后依次返回 2.迭代查询：本地域名服务器查询不到域名对应的IP地址，本地域名服务器以客户的身份向根域名服务器发送UDP请求报文，根域名服务器根据顶级域名找到顶级域名服务器的地址，返回给本地域名服务器，本地域名服务器以客户的身份向顶级域名服务器发送UDP请求报文，顶级域名服务器根据二级域名找到权限域名服务器的地址，返回给本地域名服务器，本地域名服务器以客户的身份向权限域名服务器发送UDP请求报文，权限域名服务器查询出IP地址后，返回给本地域名服务器。

本地域名服务器将查询结果保存到本地缓存，返回给客户机

3.主机向本地域名服务器的查询都是递归查询

4.本地域名服务器向其他域名服务器的查询可以采用递归也可以采用迭代

5.DNS高速缓存：为了提高DNS查询的效率，减少DNS查询报文的数量，采用高速缓存缓存最近查询的域名和地址映射的信息。并定时丢弃。主机在启动之后会从本地域名服务器上下载域名和地址的全部数据，缓存到自己的高速缓存中。

### 习题

1.一个主机对应一个域名。

一个域名可以对应多台主机。-->负载均衡

一个主机对应多个域名。-->虚拟主机  

一个域名对应多个IP地址，多个网卡在一个主机中。

2.互联网上的主机一定要有IP地址，不一定有域名。

3.DNS包含分布式数据库

4.为什么要引入域名系统？因为IP地址不好记，域名好记

## 6.3 FTP文件传输协议

### 6.3.1 FTP工作原理

1.FTP是使用最广泛的文件传输协议，屏蔽了计算机系统和底层硬件的差异，可以在任意计算机之间传输文件

2.功能：1.提供交互式访问，允许指明文件类型、文件格式、存储权限 2.通过用户权限管理远程文件 3.匿名FTP提供公有文件共享能力

3.采用C/S的工作方式，使用TCP，控制连接端口21，数据连接端口20（PORT模式）

4.FTP服务器进程由两部分组成：主进程接收请求、多个从属进程处理单个请求，主进程和从属进程是并发执行的

 5.工作流程：1.监听21端口，等待用户进程连接 2.主进程收到用户请求后，启动从属进程处理请求，处理完成后从属进程终止 3.回到等待状态，等待用户进程连接

### 6.3.2 控制连接和数据连接

1.FTP工作时有两个并行的TCP连接：控制连接和数据连接

![image-20240521094456791](https://cdn.jsdelivr.net/gh/Gaesar/Gaesar.github.io@main/pic/202405210945935.png)

2.控制连接：控制进程监听端口21，用来传输控制信息，连接请求、传送请求等。控制连接在整个会话期间一直打开。

3.数据连接：控制进程收到文件传输请求后，才创建数据传送进程和数据连接，用来传输文件。传输结束后关闭连接结束运行。

4.数据连接的两种模式：1.PORT主动模式：客户端请求连接服务器21端口，进行用户登录，登录成功后客户端随机开放一个端口，把PORT命令和开放的端口发送给服务器，服务器接收到后创建一个数据传送进程（20端口），通过收到的端口和客户端创建连接。 2.PASV被动模式：客户端读取数据时，发送PASV命令到服务器，服务器随机开放一个端口，把端口号发送给客户端，客户端连接服务器的端口。 主动模式服务器主动连接客户端，被动模式服务器等待客户端连接。

5.修改服务器上的文件要先下载到本地，然后再上传回服务器

6.FTP有单独的控制连接传送控制信息，所以控制信息是带外传送的。

7.任意用户都可以使用anonymous，密码是任意的

8.FTP工作过程：

8.1 服务器监听21端口

8.2 客户端请求连接21端口，建立控制连接，控制连接在整个会话期间保持打开，用户登录

8.3 文件传输时，客户端随机开放一个端口，通过控制连接将文件传送请求发送给服务器，服务器收到后创建一个数据传输进程，使用20端口和客户端建立数据连接

8.4 文件传输完毕后，关闭连接，结束进程

9.为什么采用两个连接？实现简单，效率高。可以随时暂停传输。



